// 实现一个命令的接口类

syntax = "proto3";

package command;

option cc_generic_services = true;

message Command
{
    
    // uint32 version = 1;  // raft 节点各自独立使用命令，不存在并发控制，不需要使用乐观锁
    oneof command_type
    {
        PutCommand put = 1;
        GetCommand get = 2;
        DeleteCommand del = 3; // delete 是 proto 的关键字，不能用作标识符
        AppendCommand append = 4;
    }
}

message PutCommand
{
    bytes key = 1;
    bytes value = 2;
}

message GetCommand
{
    bytes key = 1;
}

message DeleteCommand
{
    bytes key = 1;
}

message AppendCommand
{
    bytes key = 1;
    bytes value = 2;
}

enum StateCode
{
    OK = 0;
    ErrNoKey = 1;
    ErrVersion = 2;

    ErrMaybe = 3;

    ErrWrongLeader = 4;
    ErrWrongGroup = 5;

    // 数据库错误
    ErrDBError = 6;
}

message PutReply
{
    StateCode Err = 1;
}

message GetReply
{
    StateCode Err = 1;
    bytes value = 2;
}

message DeleteReply
{
    StateCode Err = 1;
}

message AppendReply
{
    StateCode Err = 1;
    bytes new_value = 2;
}

// 定义 service
service CommandServiceRPC
{
    rpc Put(PutCommand) returns (PutReply);
    rpc Get(GetCommand) returns (GetReply);
    rpc Delete(DeleteCommand) returns (DeleteReply);
    rpc Append(AppendCommand) returns (AppendReply);
}